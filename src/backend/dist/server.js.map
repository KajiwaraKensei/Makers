{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"http-status-codes\"","webpack:///./src/documents/resSendFail.ts","webpack:///external \"mongoose\"","webpack:///./src/documents/resSendSuccess.ts","webpack:///./src/documents/authDocument.ts","webpack:///./src/models/User.ts","webpack:///./src/models/Template.ts","webpack:///external \"express\"","webpack:///external \"firebase-admin\"","webpack:///external \"body-parser\"","webpack:///external \"@line/bot-sdk\"","webpack:///external \"cors\"","webpack:///./src/models/Comment.ts","webpack:///./src/routes/comment.ts","webpack:///./src/controllers/commentController.ts","webpack:///./src/routes/account.ts","webpack:///./src/controllers/accountController.ts","webpack:///./src/controllers/templateController.ts","webpack:///./src/routes/template.ts","webpack:///./src/server.ts","webpack:///(webpack)/node_modules/process/browser.js","webpack:///external \"heroku-config\""],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","res","status","errorMessage","json","success","send","idToken","Promise","resolve","reject","verifyIdToken","then","decodedToken","uid","catch","err","schema","type","String","required","fav","Types","ObjectId","ref","template","timestamps","Template","title","author","questions","memo","comments","tags","executionCount","Number","Todo","replay","user","router","post","req","authDocument","body","template_id","comment_id","User","findOne","targetUser","findById","targetTemplate","_id","save","result","targetComment","push","sendCommentData","date","updatedAt","contributor","resSendSuccess","comment","error","resSendFail","query","find","sort","populate","path","select","reasons","sendData","forEach","reason","console","log","commentCount","length","end","one","id","getSortKey","order","ob","range","page","keywords","split","keyword","RegExp","$and","$or","$in","skip","limit","exec","count","hit","recordsCount","templateId","data","updateOne","$set","raw","port","process","env","PORT","LINE_TOKEN","app","serviceAccount","credential","cert","databaseURL","useNewUrlParser","useUnifiedTopology","once","use","extended","next","message","config1","channelAccessToken","channelSecret","broadcast","text","e","event","events","config","client","getProfile","source","userId","pro","replyMessage","replyToken","displayName","listen","cachedSetTimeout","cachedClearTimeout","defaultSetTimout","Error","defaultClearTimeout","runTimeout","fun","setTimeout","this","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","concat","drainQueue","timeout","len","run","marker","runClearTimeout","Item","array","noop","nextTick","args","Array","arguments","apply","browser","argv","version","versions","on","addListener","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 15);\n","module.exports = require(\"http-status-codes\");","import * as Express from \"express\";\n\nexport default (\n  res: Express.Response,\n  status: number,\n  errorMessage: string = \"\"\n) => {\n  res.status(status).json({ success: false, errorMessage });\n};\n","module.exports = require(\"mongoose\");","import * as Express from \"express\";\nimport { OK } from \"http-status-codes\";\n\nexport default (res: Express.Response, send: object = { success: true }) => {\n  res.status(OK).json(send);\n};\n","import Todo from \"../models/Todo\";\nimport * as admin from \"firebase-admin\";\n\nexport default (idToken: string) => {\n  return new Promise(function(\n    resolve: (uid: string) => void,\n    reject: (errMessage: string) => void\n  ) {\n    if (!idToken) {\n      reject(\"認証情報が見つかりません\");\n      return;\n    }\n    admin\n      .auth()\n      .verifyIdToken(idToken)\n      .then(decodedToken => {\n        resolve(decodedToken.uid);\n      })\n      .catch(err => {\n        reject(\"認証に失敗しました\");\n      });\n  });\n};\n","import * as mongoose from \"mongoose\";\nexport interface IUserDocument extends mongoose.Document {\n  name: string;\n  uid: string;\n  fav: any[];\n  template: any[];\n}\nconst schema = new mongoose.Schema(\n  {\n    name: {\n      type: String,\n      required: true\n    },\n    uid: {\n      type: String,\n      required: true\n    },\n    fav: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: \"Template\"\n      }\n    ],\n    template: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: \"Template\",\n        required: true\n      }\n    ]\n  },\n  {\n    timestamps: true\n  }\n);\n\nconst Template = mongoose.model<IUserDocument>(\"User\", schema);\n\nexport default Template;\n","import * as mongoose from \"mongoose\";\nexport interface ITemplateDocument extends mongoose.Document {\n  title: string;\n  author: any;\n  questions: object[];\n  memo: string;\n  comments: any[];\n  tags: string[];\n  fav: any[];\n  executionCount: number;\n  template: string;\n  updatedAt: any;\n}\nconst schema = new mongoose.Schema(\n  {\n    title: {\n      type: String\n    },\n    author: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: \"User\",\n      required: true\n    },\n    questions: [\n      {\n        type: Object\n      }\n    ],\n    memo: {\n      type: String\n    },\n    comments: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: \"Comment\"\n      }\n    ],\n    tags: [\n      {\n        type: String\n      }\n    ],\n    template: {\n      type: String\n    },\n    executionCount: {\n      type: Number\n    },\n    fav: [\n      {\n        type: mongoose.Schema.Types.ObjectId,\n        ref: \"Users\"\n      }\n    ]\n  },\n  {\n    timestamps: true\n  }\n);\n\nconst Todo = mongoose.model<ITemplateDocument>(\"Template\", schema);\n\nexport default Todo;\n","module.exports = require(\"express\");","module.exports = require(\"firebase-admin\");","module.exports = require(\"body-parser\");","module.exports = require(\"@line/bot-sdk\");","module.exports = require(\"cors\");","import * as mongoose from \"mongoose\";\nexport interface IUserDocument extends mongoose.Document {\n  replay: any[];\n  template: any;\n  value: string;\n  user: any;\n  updatedAt: any;\n}\nconst schema = new mongoose.Schema(\n  {\n    replay: [{ type: mongoose.Schema.Types.ObjectId, ref: \"Comment\" }],\n    value: {\n      type: String,\n      required: true\n    },\n    template: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: \"Template\",\n      required: true\n    },\n    user: {\n      type: mongoose.Schema.Types.ObjectId,\n      ref: \"User\",\n      required: true\n    }\n  },\n  {\n    timestamps: true\n  }\n);\n\nconst Comment = mongoose.model<IUserDocument>(\"Comment\", schema);\n\nexport default Comment;\n","import * as Express from \"express\";\nimport { addComment, getComment } from \"../controllers/commentController\";\n\nconst router = Express.Router();\n\nrouter.post(\"/add\", addComment);\nrouter.get(\"/\", getComment);\nexport default router;\n","import * as Express from \"express\";\nimport authDocument from \"../documents/authDocument\";\nimport User from \"../models/User\";\nimport Comment from \"../models/Comment\";\nimport Template from \"../models/Template\";\nimport * as status from \"http-status-codes\";\nimport resSendFail from \"../documents/resSendFail\";\nimport resSendSuccess from \"../documents/resSendSuccess\";\n\n// コメントの追加\nexport const addComment = (req: Express.Request, res: Express.Response) => {\n  try {\n    authDocument(req.body.idToken as string)\n      .then(async uid => {\n        const { value, template_id, comment_id } = req.body;\n        const targetUser = await User.findOne({ uid });\n        let targetTemplate = await Template.findById(template_id);\n        const newComment = new Comment({\n          replay: [],\n          template: targetTemplate._id,\n          user: targetUser._id,\n          value\n        });\n        const result = await newComment.save();\n\n        if (comment_id) {\n          let targetComment = await Comment.findById(comment_id);\n          targetComment.replay.push(result._id);\n          await targetComment.save();\n        }\n        targetTemplate.comments.push(result._id);\n        targetTemplate.save();\n        const sendCommentData = {\n          value: result.value,\n          date: result.updatedAt,\n          contributor: {\n            name: \"あなた\",\n            uid\n          }\n        };\n        resSendSuccess(res, { success: true, comment: sendCommentData });\n      })\n\n      .catch(error => {\n        resSendFail(res, status.PRECONDITION_FAILED, error);\n      });\n  } catch {}\n};\n\n// コメントの取得\nexport const getComment = async (\n  req: Express.Request,\n  res: Express.Response\n) => {\n  try {\n    const query = req.query;\n    await Comment.find({\n      template: query.template_id\n    })\n      .sort({ updatedAt: -1 })\n      .populate({ path: \"user\", select: [\"name\", \"uid\"] })\n      .then(reasons => {\n        const sendData = [];\n        reasons.forEach(reason => {\n          sendData.push({\n            value: reason.value,\n            date: reason.updatedAt,\n            contributor: {\n              name: reason.user ? reason.user.name : \"不明\",\n              uid: reason.user ? reason.user.uid : \"124\"\n            }\n          });\n        });\n        console.log(sendData);\n\n        resSendSuccess(res, {\n          success: true,\n          result: sendData,\n          commentCount: sendData.length\n        });\n      })\n      .catch(error => {\n        console.log(error);\n\n        resSendFail(res, status.PRECONDITION_FAILED, error);\n      });\n  } catch {\n    error => {\n      console.log(error);\n      resSendFail(res, status.INTERNAL_SERVER_ERROR, \"サーバーエラー\");\n    };\n  }\n};\n","import * as Express from \"express\";\nimport {\n  addUser,\n  changeUserName,\n  getUserInfo\n} from \"../controllers/accountController\";\n\nconst router = Express.Router();\n\nrouter.post(\"/add\", addUser);\nrouter.post(\"/change_name\", changeUserName);\nrouter.post(\"/\", getUserInfo);\nexport default router;\n","import * as Express from \"express\";\nimport authDocument from \"../documents/authDocument\";\nimport User from \"../models/User\";\nimport * as status from \"http-status-codes\";\nimport resSendSuccess from \"../documents/resSendSuccess\";\nimport resSendFail from \"../documents/resSendFail\";\n\n// addUser\n// ユーザーの追加\nexport const addUser = (req: Express.Request, res: Express.Response) => {\n  //トークン( req.body.idToken )が正しいかの認証。　正しかったらユーザーIDが帰ってくる\n  authDocument(req.body.idToken as string)\n    .then(uid => {\n      // ユーザーの作成\n      const newUser = new User({\n        name: req.body.name,\n        uid,\n        fav: [],\n        template: []\n      });\n\n      // ユーザーの保存\n      return newUser.save();\n    })\n    .then(result => {\n      console.log(\"Success! _id: \" + result._id);\n      res\n        .status(status.OK)\n        .json({ success: true, name: result.name })\n        .end();\n    })\n    .catch(err => {\n      res\n        .status(status.PRECONDITION_FAILED)\n        .json({ success: false, errorMessage: err })\n        .end();\n    });\n};\n// changeUserName\n// ユーザー名の変更\nexport const changeUserName = (req: Express.Request, res: Express.Response) => {\n  authDocument(req.body.idToken as string)\n    .then(async uid => {\n      // 対象のユーザーの検索\n      let targetUser = await User.findOne({ uid });\n\n      // 変更\n      targetUser.name = req.body.name;\n\n      // 保存\n      return targetUser.save();\n    })\n    .then(result => {\n      console.log(\"Success change name! _id: \" + result._id);\n      res\n        .status(status.OK)\n        .json({ success: true })\n        .end();\n    })\n    .catch(err => {\n      res\n        .status(status.PRECONDITION_FAILED)\n        .json({ success: false, errorMessage: err })\n        .end();\n    });\n};\nexport const getUserInfo = (req: Express.Request, res: Express.Response) => {\n  authDocument(req.body.idToken as string)\n    .then(async uid => {\n      // 対象のユーザーの検索\n      let targetUser = await User.findOne({ uid }).populate({\n        path: \"template\",\n        select: [\n          \"executionCount\",\n          \"title\",\n          \"fav\",\n          \"tags\",\n          \"memo\",\n          \"comments\",\n          \"updatedAt\",\n          \"template\",\n          \"questions\"\n        ]\n      });\n      if (!targetUser) {\n        resSendFail(res, status.NOT_FOUND, \"見つかりません\");\n        return;\n      }\n      let template = [];\n      targetUser.template.forEach(one => {\n        template = [\n          ...template,\n          {\n            id: one._id,\n            title: one.title,\n            executionCount: one.executionCount,\n            tags: one.tags,\n            memo: one.memo,\n            fav: one.fav.length,\n            comments: one.comments.length,\n            date: one.updatedAt,\n            questions: one.questions,\n            template: one.template\n          }\n        ];\n      });\n      console.log(template);\n\n      resSendSuccess(res, { success: true, uid: targetUser.uid, template });\n    })\n    .catch(err => {\n      res\n        .status(status.PRECONDITION_FAILED)\n        .json({ success: false, errorMessage: err })\n        .end();\n    });\n};\n","import * as Express from \"express\";\nimport authDocument from \"../documents/authDocument\";\nimport * as status from \"http-status-codes\";\nimport User from \"../models/User\";\nimport Template, { ITemplateDocument } from \"../models/Template\";\nimport resSendFail from \"../documents/resSendFail\";\nimport resSendSuccess from \"../documents/resSendSuccess\";\n\n// ______________________________________________________\n// addTemplate\n// テンプレートの追加\n\nexport const addTemplate = (req: Express.Request, res: Express.Response) => {\n  try {\n    //トークン ( req.body.idToken ) が正しいかの検証。　正しければユーザーIDが帰ってくる\n    authDocument(req.body.idToken as string)\n      .then(async uid => {\n        let targetUser = await User.findOne({ uid });\n        console.log(targetUser);\n\n        console.log(\"_id: \" + targetUser._id);\n\n        // テンプレートの作成\n        const { title, questions, memo, tags, template } = req.body;\n        const newTemplate = new Template({\n          title,\n          author: targetUser._id,\n          questions,\n          memo,\n          comments: [],\n          tags,\n          template,\n          executionCount: 0\n        });\n\n        // テンプレートの保存\n        const result = await newTemplate.save();\n\n        // ユーザー情報の変更\n        targetUser.template = [...targetUser.template, result._id];\n\n        // ユーザーの保存\n        await targetUser.save();\n\n        console.log(\"Success! _id: \" + result._id);\n        resSendSuccess(res, {\n          success: true,\n          id: result._id\n        });\n      })\n      .catch(error => {\n        console.log(error);\n\n        resSendFail(res, status.PRECONDITION_FAILED, error);\n      });\n  } catch {\n    error => {\n      console.log(error);\n      resSendFail(res, status.INTERNAL_SERVER_ERROR, \"サーバーエラー\");\n    };\n  }\n};\n// ______________________________________________________\n// updateTemplate\n\nexport const updateTemplate = (req: Express.Request, res: Express.Response) => {\n  try {\n    console.log(\"try template update\");\n\n    authDocument(req.body.idToken as string)\n      .then(async uid => {\n        console.log(\"uid: \" + uid);\n        console.log(\"id: \" + req.body.id);\n        console.log(\"data: \");\n        console.log(req.body.data);\n        const targetUser = await User.findOne({ uid });\n        console.log(\"targetUser: \");\n        console.log(targetUser);\n\n        // デンプレートの更新\n        Template.updateOne(\n          { _id: req.body.id, author: targetUser._id },\n          { $set: req.body.data },\n          (error, raw) => {\n            if (error) {\n              console.log(\"error: \");\n\n              console.log(error);\n              resSendFail(res, status.EXPECTATION_FAILED, error);\n            } else {\n              console.log(raw);\n              resSendSuccess(res);\n            }\n          }\n        );\n      })\n      .catch(error => {\n        resSendFail(res, status.PRECONDITION_FAILED, error);\n      });\n  } catch {\n    error => {\n      console.log(error);\n      resSendFail(res, status.INTERNAL_SERVER_ERROR, \"サーバーエラー\");\n    };\n  }\n};\n\n// ______________________________________________________\n// countUpTemplate\n\nexport const countUpTemplate = async (\n  req: Express.Request,\n  res: Express.Response\n) => {\n  try {\n    let targetTemplate = await Template.findById(req.body.id);\n    console.log(targetTemplate);\n    if (!!!targetTemplate) {\n      resSendFail(res, status.NOT_FOUND, \"テンプレートが見つかりませんでした\");\n      return;\n    }\n    targetTemplate.executionCount++;\n    targetTemplate.save();\n    resSendSuccess(res);\n  } catch {\n    error => {\n      console.log(error);\n      resSendFail(res, status.INTERNAL_SERVER_ERROR, \"サーバーエラー\");\n    };\n  }\n};\n// ______________________________________________________\n//\nexport const doTemplateFav = (req: Express.Request, res) => {\n  try {\n    //トークン ( req.body.idToken ) が正しいかの検証。　正しければユーザーIDが帰ってくる\n    authDocument(req.body.idToken as string)\n      .then(async uid => {\n        let targetTemplate = await Template.findOne({ _id: req.body.id });\n        let targetUser = await User.findOne({ uid });\n        targetUser.fav.push(targetTemplate._id);\n        targetUser.fav = targetUser.fav.filter(\n          (x, i, self) => self.indexOf(x) === i\n        );\n        targetTemplate.fav.push(targetTemplate._id);\n        targetTemplate.fav = targetTemplate.fav.filter(\n          (x, i, self) => self.indexOf(x) === i\n        );\n\n        targetTemplate.save();\n        targetUser.save();\n        resSendSuccess(res);\n      })\n      .catch(error => {\n        resSendFail(res, status.PRECONDITION_FAILED, error);\n      });\n  } catch {\n    error => {\n      console.log(error);\n      resSendFail(res, status.INTERNAL_SERVER_ERROR, \"サーバーエラー\");\n    };\n  }\n};\n// ______________________________________________________\n//\n\nexport const doDeleteTemplateFav = (req: Express.Request, res) => {\n  try {\n    //トークン ( req.body.idToken ) が正しいかの検証。　正しければユーザーIDが帰ってくる\n    authDocument(req.body.idToken as string)\n      .then(async uid => {\n        let targetTemplate = await Template.findOne({ _id: req.body.id });\n        let targetUser = await User.findOne({ uid });\n\n        targetUser.fav = targetUser.fav.filter(v => v !== targetTemplate._id);\n        targetTemplate.fav = targetTemplate.fav.filter(\n          v => v !== targetUser._id\n        );\n        targetTemplate.save();\n        targetUser.save();\n        resSendSuccess(res);\n      })\n      .catch(error => {\n        resSendFail(res, status.PRECONDITION_FAILED, error);\n      });\n  } catch {\n    error => {\n      console.log(error);\n      resSendFail(res, status.INTERNAL_SERVER_ERROR, \"サーバーエラー\");\n    };\n  }\n};\n// ______________________________________________________\n// countUpTemplate\n\nexport const getTemplate = async (req: Express.Request, res) => {\n  try {\n    const templateId = req.body.templateId;\n    console.log(templateId);\n\n    await Template.findById(\n      templateId,\n      (err: any, targetTemplate: ITemplateDocument) => {\n        if (err) {\n          console.log(\"見つからない\");\n          resSendFail(res, status.PRECONDITION_FAILED, \"見つかりませんでした\");\n          return;\n        }\n        console.log(\"success\");\n        console.log(targetTemplate);\n\n        resSendSuccess(res, {\n          success: true,\n          author: targetTemplate.author,\n          title: targetTemplate.title,\n          questions: targetTemplate.questions,\n          memo: targetTemplate.memo,\n          tags: targetTemplate.tags,\n          template: targetTemplate.template,\n          fav: targetTemplate.fav.length\n        });\n      }\n    );\n  } catch {\n    error => {\n      console.log(error);\n      resSendFail(res, status.INTERNAL_SERVER_ERROR, \"サーバーエラー\");\n    };\n  }\n};\n\nexport const showTemplates = (req: Express.Request, res: Express.Response) => {\n  try {\n    console.log(\"show\");\n\n    const query = req.query;\n    let QueryData = {\n      range: 10,\n      page: 1,\n      sort: 0,\n      order: -1,\n      tags: [],\n      keywords: []\n    };\n    if (query.range) {\n      const range = query.range - 0;\n      if (range <= 100 && 0 < range) {\n        QueryData[\"range\"] = range;\n      }\n    }\n    if (query.page) {\n      if (query.page - 0 > 0) QueryData[\"page\"] = query.page - 0;\n    }\n    if (query.sort) {\n      const sort = query.sort - 0;\n      if (0 <= sort && sort < 3) {\n        QueryData[\"sort\"] = sort;\n      }\n    }\n    if (query.order) {\n      const order = query.order - 0;\n      if (order === 1) QueryData[\"order\"] = 1;\n    }\n    if (query.tags) {\n      //const tags = query.tags.split(\"||\");\n      //let _tags = [];\n      //tags.forEach(tag => _tags.push(new RegExp(tag)));\n      QueryData[\"tags\"] = (query.tags as string).split(\"||\");\n    }\n\n    if (query.keywords) {\n      const keywords = (query.keywords as string).split(\"||\");\n      let _keywords = [];\n      keywords.forEach(keyword => _keywords.push(new RegExp(keyword)));\n      QueryData[\"keywords\"] = _keywords;\n    }\n    let ob = {};\n    if (QueryData.keywords.length && QueryData.tags.length) {\n      ob = {\n        $and: [\n          {\n            $or: [\n              { title: { $in: QueryData.keywords } },\n              { template: { $in: QueryData.keywords } },\n              { memo: { $in: QueryData.keywords } }\n            ]\n          },\n          { tags: { $in: QueryData.tags } }\n        ]\n      };\n    } else if (QueryData.keywords.length) {\n      ob = {\n        $or: [\n          { title: { $in: QueryData.keywords } },\n          { template: { $in: QueryData.keywords } },\n          { memo: { $in: QueryData.keywords } }\n        ]\n      };\n    } else if (QueryData.tags.length) {\n      ob = { tags: { $in: QueryData.tags } };\n    }\n    Template.find(ob)\n      .sort(getSortKey(QueryData.sort, QueryData.order))\n      .skip(QueryData.range * (QueryData.page - 1))\n      .limit(QueryData.range)\n      .populate([{ path: \"author\", select: \"name\" }])\n      .exec(async (error, result) => {\n        if (error) {\n          console.log(error);\n\n          resSendFail(res, status.NOT_FOUND, \"見つかりませんでした\");\n          return;\n        }\n        let sendData = [];\n        result.forEach(one => {\n          console.log(one.updatedAt);\n          const {\n            questions,\n            comments,\n            tags,\n            fav,\n            _id,\n            title,\n            author,\n            memo,\n            template,\n            executionCount,\n            updatedAt\n          } = one;\n          sendData = [\n            ...sendData,\n            {\n              id: _id,\n              questions,\n              comments: comments.length,\n              tags,\n              fav: fav.length,\n              title,\n              author: author ? author : { _id: \"\", name: \"不明\" },\n              memo,\n              template,\n              executionCount,\n              date: updatedAt\n            }\n          ];\n        });\n        const hit = await Template.find(ob).count();\n        console.log(sendData);\n\n        resSendSuccess(res, {\n          success: true,\n          result: sendData,\n          recordsCount: sendData.length,\n          page: QueryData.page,\n          range: QueryData.range,\n          hit\n        });\n      })\n      .catch(err => {\n        console.log(err);\n        resSendFail(res, status.PRECONDITION_FAILED, \"エラー\");\n      });\n  } catch {\n    error => {\n      console.log(error);\n      resSendFail(res, status.INTERNAL_SERVER_ERROR, \"サーバーエラー\");\n    };\n  }\n};\n\nconst getSortKey = (sort, order) => {\n  const sortType = [\"updatedAt\", \"fav\", \"executionCount\"];\n  const ob = {};\n  ob[sortType[sort]] = order;\n  console.log(ob);\n  return ob;\n};\n","import * as Express from \"express\";\nimport {\n  addTemplate,\n  getTemplate,\n  updateTemplate,\n  showTemplates,\n  countUpTemplate\n} from \"../controllers/templateController\";\nconst router = Express.Router();\n\nrouter.get(\"/\", showTemplates);\nrouter.post(\"/execution\", countUpTemplate);\nrouter.post(\"/add\", addTemplate);\nrouter.post(\"/get\", getTemplate);\nrouter.post(\"/save\", updateTemplate);\n\nexport default router;\n","var port = process.env.PORT || 3000;\nconsole.log(process.env);\nimport { Request, Response, NextFunction } from \"express\";\nimport * as mongoose from \"mongoose\";\nimport Todo from \"./models/Todo\";\nimport * as bodyParser from \"body-parser\";\nimport * as admin from \"firebase-admin\";\nimport account from \"./routes/account\";\nimport template from \"./routes/template\";\nimport comment from \"./routes/comment\";\nimport \"heroku-config\";\nimport * as express from \"express\";\nimport * as line from \"@line/bot-sdk\";\nimport cors from \"cors\";\n\nconst LINE_TOKEN =\n  \"tJ0gD50beqUdBmjz40sNcIKssWqcZ2Zz9OhhzK6ERi18BfWaa1rfm7ACtS+jK+cBb6nIFWZ0QlxNNGFCq6/8nUsXugrOywRLOLyO1jqwhWfjRTcfLn3fPVr8x7PVh6dDuZUNsHyC6MdQONSYAceVLQdB04t89/1O/w1cDnyilFU=\";\nconst LINE_CEACLET = \"a5317881e5a3f3b03531afe56aec483d\";\n//declare var process: NodeJS.Process;\n// export interface ProcessEnv {\n//   [key: string]: string | undefined;\n// }\nconst app = express();\nconst url =\n  \"mongodb://heroku_pkdqdmpl:og9870460gbsevrjf401f9542v@ds257054.mlab.com:57054/heroku_pkdqdmpl\";\n//\"mongodb://mongodb/myapp\";\n//const port = process.env.PORT || 3000;\n\n// =======================\n// configuration\n// =======================\n// server setting\n\nlet serviceAccount = require(\"../template-2013-firebase-adminsdk-nfjo5-366a604e70.json\");\n\nadmin.initializeApp({\n  credential: admin.credential.cert(serviceAccount),\n  databaseURL: \"https://template-2013.firebaseio.com\"\n});\nmongoose.connect(url, {\n  useNewUrlParser: true,\n  useUnifiedTopology: true\n});\nconst db = mongoose.connection;\ndb.once(\"open\", () => {\n  console.log(\"Successfully connected to MongoDB using Mongoose!\");\n});\n\napp.use(bodyParser.urlencoded({ extended: false }));\napp.use(bodyParser.json());\n\n// =======================\n// routes\n// =======================\n\napp.use(cors());\napp.use(\"/account\", account);\napp.use(\"/template\", template);\napp.use(\"/comment\", comment);\napp.get(\"/\", (req: Request, res: Response, next: NextFunction) => {\n  const { message } = req.query;\n  const config1 = {\n    channelAccessToken: LINE_TOKEN,\n    channelSecret: LINE_CEACLET\n  };\n\n  const client1 = new line.Client(config1);\n\n  client1\n    .broadcast({\n      type: \"text\",\n      text: message\n    })\n    .then(data => res.status(200).send({ data }))\n    .catch(e => res.status(200).send({ e }));\n});\napp.post(\"/\", async (req: Request, res: Response, next: NextFunction) => {\n  const event = req.body.events[0];\n  const config = {\n    channelAccessToken: LINE_TOKEN,\n    channelSecret: LINE_CEACLET\n  };\n  const client = new line.Client(config);\n\n  const pro = await client.getProfile(event.source.userId);\n\n  client.replyMessage(event.replyToken, {\n    type: \"text\",\n    text: `${pro.displayName}さん : 「${event.message.text}」と入力`\n  });\n\n  res.status(200).send();\n});\n\napp.listen(port, () => {\n  console.log(`Listen on port ${port}.`);\n});\n\nexport default app;\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","module.exports = require(\"heroku-config\");"],"sourceRoot":""}